<?xml version="1.0" encoding="UTF-8"?>
<blueprint xmlns="http://www.osgi.org/xmlns/blueprint/v1.0.0"
	xmlns:cm="http://aries.apache.org/blueprint/xmlns/blueprint-cm/v1.0.0"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.osgi.org/xmlns/blueprint/v1.0.0 https://www.osgi.org/xmlns/blueprint/v1.0.0/blueprint.xsd http:/camel.apache.org/schema/blueprint http://camel.apache.org/schema/blueprint/camel-blueprint.xsd">

	<camelContext allowUseOriginalMessage="false"
		id="contextoCamelProcesador" xmlns="http://camel.apache.org/schema/blueprint">
		<endpoint uri="infinispan://?cacheContainer=#cacheManager"
			id="datagrid" />
		<route autoStartup="true" id="transformacionDeMensajes"
			startupOrder="2">
			<from uri="activemq:topic:BIVA.ITCH.FEED" id="leerMensajeJMS">
				<description />
			</from>
			<log message="${body}" />
			<process ref="deserializador" id="deserializarMensajes" />
			<to uri="transformadorMensaje" id="transformarMensaje" />
			<split parallelProcessing="true" id="divideResultado">
				<simple>${body}</simple>
				<convertBodyTo
					type="mx.com.actinver.terminal.notificaciones.DestinoObjeto" id="convierteEnObjeto" />
				<setHeader headerName="destino" id="agregaCabeceraDestino">
					<simple>${in.body.destino}</simple>
				</setHeader>
				<setHeader headerName="emisoraserie" id="agregaCabeceraEmisoraSerie">
					<simple>${in.body.emisoraSerie}</simple>
				</setHeader>
				<setBody id="agregaCuerpoObjetoSerializadoPorPipes">
					<simple>${in.body.objeto}</simple>
				</setBody>
				<convertBodyTo type="java.lang.String" id="convierteCuerpoaCadena" />
				<recipientList parallelProcessing="true"
					id="enviaMensajeaTopicos">
					<simple>activemq:topic:${in.header.destino}</simple>
				</recipientList>
			</split>
		</route>
	</camelContext>

</beans>
